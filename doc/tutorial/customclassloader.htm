<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<title>Using A Custom ClassLoader - Abacus Formula Compiler for Java</title>
    <style type="text/css" media="screen">
		
    </style>
	<link href="../../style_screen.css" rel="stylesheet" type="text/css" media="screen" /><link href="../../style_print.css" rel="stylesheet" type="text/css" media="print" />

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1112076-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</head>

<body>
	<div id="outer">
		<div id="left_background">
		</div>
		<div id="top_background">
		</div>
		
		<div class="chrome" id="top_chrome">
			<div id="logo_band">
				<img src="../../site_img/header_bar.gif" alt="AFC - Abacus Formula Compiler for Java" />
			</div>
			<div id="download_band">
				<a href="../../download/index.htm">
					<img src="../../site_img/download_button.gif" />
				</a>
			</div>
			<div id="area_band">
				<table height="100%"><tr height="100%"><td style="vertical-align:middle">
						
					<a href="../../index.htm">Home</a> | 
						
					<a href="../../quick.htm">Quick Start</a> | <span class="selected"><a href="../../doc/index.htm">Documentation</a></span> | <a href="../../download/index.htm">Download</a> | <a href="../../support/index.htm">Support</a> | <a href="../../contribute/index.htm">Contribute</a>
				</td></tr></table>
			</div>
		</div>

		<div id="inner">
			<div class="chrome" id="inner_top_chrome">
				<div id="crumbs_band">
					<a href="../../index.htm">Home</a> &gt; <a href="../index.htm">Documentation</a> &gt; <a href="index.htm">Tutorial</a> &gt; 
				</div>
			</div>

			<div class="content" id="content">

<h1>Using A Custom ClassLoader</h1>

	<p>Some companies use a custom <code>ClassLoader</code> to, for example, speed up class loading. If you don&#8217;t replace Java&#8217;s default class loader (<code>ClassLoader.getSystemClassLoader()</code>), you may have to make sure that the engines generated by <span class="caps">AFC</span> use your custom implementation.</p>


	<p>This is because <span class="caps">AFC</span>&#8217;s engines are themselves class loaders which load the Java byte code generated by <span class="caps">AFC</span>&#8217;s spreadsheet compiler. To ensure that your class loader is used when the generated engine needs to access other classes, your class loader must be passed to the engine as a <em>custom parent class loader</em>.</p>


	<p>To set the custom class loader for compiling engines, do as follows:</p>

	<pre class="java">builder.<span class="j-hl">setParentClassLoaderForEngine</span><span class="j-sym">( </span>myClassLoader <span class="j-sym">)</span>;
SaveableEngine compiledEngine = builder.compile<span class="j-sym">()</span>;
assertSame<span class="j-sym">( </span>myClassLoader, <span class="j-sym">((</span>ClassLoader<span class="j-sym">) </span>compiledEngine<span class="j-sym">)</span>.getParent<span class="j-sym">() )</span>;</pre>


	<p>To set it for loading engines, you have to allocate a special configuration object for the engine loader. The code looks like this:</p>

	<pre class="java">EngineLoader.Config cfg = <span class="j-key">new </span>EngineLoader.Config<span class="j-sym">()</span>;
cfg.<span class="j-hl">parentClassLoader</span> = myClassLoader;
Engine loadedEngine = FormulaRuntime.loadEngine<span class="j-sym">( </span>cfg, <span class="j-key">new </span>ByteArrayInputStream<span class="j-sym">( </span>bytes <span class="j-sym">) )</span>;
assertSame<span class="j-sym">( </span>myClassLoader, <span class="j-sym">((</span>ClassLoader<span class="j-sym">) </span>loadedEngine<span class="j-sym">)</span>.getParent<span class="j-sym">() )</span>;</pre>


	<h5>Warning</h5>

	<p>Please note that the cast from <span class="caps">AFC</span>&#8217;s <code>Engine</code> to <code>ClassLoader</code> is an implementation detail that you must <strong>not rely on</strong>. It is shown here only to let you see the <em>current effect</em> of setting the custom parent class loader.</p>


	<p>In particular, <span class="caps">AFC</span> only guarantees that if you set the custom parent class loader, then it will be used as the parent class loader for any of class loader <span class="caps">AFC</span> might instantiate internally for an engine.</p>

			</div>
			<div class="chrome" id="inner_bottom_chrome">
			</div>
		</div>
		
		
		
		<div class="chrome" id="left_top_chrome">
			<div id="area_toc"><div class="area"><a href="../../doc/design.htm">Design Overview</a></div>
<div class="area"><span class="selected"><a href="../../doc/tutorial/index.htm">Tutorial</a></span></div>
<div class="nested">
<div class="area"><span class="selected">Using A Custom ClassLoader</span></div>
</div>
<div class="area"><a href="../../doc/reference/index.htm">Function Reference</a></div>
<div class="area"><a href="../../doc/javadoc/index.html">API Reference</a></div>
<div class="area"><a href="../../doc/examples/index.htm">Sample Applications</a></div>
<div class="area"><a href="../../doc/impl/index.htm">Implementation Details</a></div>
<div class="area"><a href="../../doc/limitations.htm">Limitations</a></div></div>
		</div>
		</div>
		<div class="chrome" id="left_bottom_chrome">
			<div id="copyright">
				Copyright &copy; 2005-2008 by <a href="http://www.abacus.ch/">Abacus Research AG</a>.  All rights reserved.
			</div>
		</div>
	
</body>
</html>
